# CodeMentor Backend Configuration Template
# Copy this file to .env and fill in your actual values
# NEVER commit .env to git - it contains secrets!

# =============================================================================
# CRITICAL: Generate Strong Secrets
# =============================================================================
# Generate secure random secrets with:
#   python -c 'import secrets; print(secrets.token_urlsafe(32))'
#
# IMPORTANT: Use different secrets for each environment (dev/staging/prod)
# IMPORTANT: Each secret (SECRET_KEY, JWT_SECRET_KEY) should be unique

SECRET_KEY=<generate-with-secrets.token_urlsafe(32)>
JWT_SECRET_KEY=<generate-with-secrets.token_urlsafe(32)>

# =============================================================================
# Application Settings
# =============================================================================
APP_NAME=CodeMentor
APP_ENV=development  # Options: development, staging, production
DEBUG=False
HOST=0.0.0.0
PORT=5000

# =============================================================================
# Database Configuration
# =============================================================================
# PostgreSQL connection string
# Format: postgresql://username:password@host:port/database
# Example: postgresql://myuser:mypassword@localhost:5432/codementor_dev
DATABASE_URL=postgresql://username:password@localhost:5432/llm_tutor_dev

# Connection pool settings (adjust based on workers × threads × 2 + overhead)
DATABASE_POOL_SIZE=20
DATABASE_MAX_OVERFLOW=10

# =============================================================================
# Redis Configuration
# =============================================================================
# Redis connection string
# Format: redis://host:port/db
# Example: redis://localhost:6379/0
REDIS_URL=redis://localhost:6379/0
REDIS_SESSION_DB=1

# =============================================================================
# JWT Token Configuration
# =============================================================================
JWT_ALGORITHM=HS256
JWT_ACCESS_TOKEN_EXPIRE_HOURS=24
JWT_REFRESH_TOKEN_EXPIRE_DAYS=30

# =============================================================================
# OAuth Providers (Optional - Leave empty if not using)
# =============================================================================
# GitHub OAuth
GITHUB_CLIENT_ID=<your-github-client-id>
GITHUB_CLIENT_SECRET=<your-github-client-secret>

# Google OAuth
GOOGLE_CLIENT_ID=<your-google-client-id>
GOOGLE_CLIENT_SECRET=<your-google-client-secret>

# =============================================================================
# LLM API Keys
# =============================================================================
# GROQ (Primary LLM provider)
GROQ_API_KEY=<your-groq-api-key>
GROQ_MODEL=llama-3.3-70b-versatile
GROQ_COMPOUND_MODEL=groq/compound
GROQ_RATE_LIMIT_RPM=30
GROQ_RATE_LIMIT_RPD=14400
GROQ_MAX_RETRIES=3
GROQ_TIMEOUT=30

# OpenAI (Optional fallback)
OPENAI_API_KEY=<your-openai-api-key-if-using>

# Anthropic (Optional fallback)
ANTHROPIC_API_KEY=<your-anthropic-api-key-if-using>

# LLM Configuration
LLM_PRIMARY_PROVIDER=groq
LLM_FALLBACK_PROVIDER=openai
LLM_MAX_TOKENS=2000
LLM_TEMPERATURE=0.7

# =============================================================================
# Email Service (Optional)
# =============================================================================
EMAIL_PROVIDER=sendgrid
SENDGRID_API_KEY=<your-sendgrid-api-key-if-using>
EMAIL_FROM=noreply@codementor.io

# =============================================================================
# Matrix Chat (Optional)
# =============================================================================
MATRIX_HOMESERVER=https://matrix.org
MATRIX_ACCESS_TOKEN=<your-matrix-token-if-using>

# =============================================================================
# Rate Limiting (SEC-3 Enhancement)
# =============================================================================
# General API rate limiting
RATE_LIMIT_PER_MINUTE=60
RATE_LIMIT_BURST=10

# Tiered rate limits by user role
# Chat endpoints (requests per minute)
RATE_LIMIT_CHAT_PER_MINUTE_STUDENT=10
RATE_LIMIT_CHAT_PER_MINUTE_ADMIN=30

# Exercise generation (requests per hour - expensive operation)
RATE_LIMIT_EXERCISE_GENERATION_PER_HOUR=3
RATE_LIMIT_EXERCISE_GENERATION_PER_HOUR_ADMIN=10

# Hint requests (requests per hour - moderate cost)
RATE_LIMIT_HINT_PER_HOUR=5
RATE_LIMIT_HINT_PER_HOUR_ADMIN=15

# Daily cost limits in USD (prevents LLM API cost overruns)
DAILY_COST_LIMIT_STUDENT=1.00
DAILY_COST_LIMIT_ADMIN=10.00

# Cost warning threshold (0.8 = 80% of daily limit)
COST_WARNING_THRESHOLD=0.8

# =============================================================================
# Logging
# =============================================================================
LOG_LEVEL=INFO
LOG_FORMAT=json

# =============================================================================
# CORS and URLs
# =============================================================================
# Frontend URL (use HTTPS in production!)
FRONTEND_URL=http://localhost:3000

# Backend URL (use HTTPS in production!)
BACKEND_URL=http://localhost:5000

# CORS allowed origins (comma-separated)
CORS_ORIGINS=http://localhost:3000

# =============================================================================
# Security Settings
# =============================================================================
BCRYPT_ROUNDS=12
PASSWORD_MIN_LENGTH=12

# =============================================================================
# Monitoring & Observability (OPS-1)
# =============================================================================
# Sentry error tracking (optional but recommended for production)
# Get DSN from https://sentry.io/ after creating a project
SENTRY_DSN=<your-sentry-dsn-url>
SENTRY_ENABLED=false  # Set to true in production
SENTRY_SAMPLE_RATE=1.0  # 1.0 = 100% of errors captured
SENTRY_TRACES_SAMPLE_RATE=0.1  # 0.1 = 10% of transactions for performance monitoring

# Prometheus metrics
METRICS_ENABLED=true  # Set to true to expose /metrics endpoint

# =============================================================================
# Notes on Monitoring
# =============================================================================
# DEVELOPMENT:
# - SENTRY_ENABLED=false (errors logged only, not sent to Sentry)
# - METRICS_ENABLED=true (useful for local debugging)
#
# PRODUCTION:
# - SENTRY_ENABLED=true
# - SENTRY_DSN=<your-production-sentry-dsn>
# - METRICS_ENABLED=true
# - Set up Prometheus scraping of /metrics endpoint
# - Set up Grafana dashboards for visualization
# - Configure alerting thresholds

# =============================================================================
# Notes for Different Environments
# =============================================================================
#
# DEVELOPMENT:
# - Use HTTP URLs (http://localhost:*)
# - Optional LLM API keys
# - DEBUG=True
#
# STAGING/PRODUCTION:
# - MUST use HTTPS URLs
# - MUST set strong secrets (32+ chars, random)
# - MUST have GROQ_API_KEY if using GROQ
# - DEBUG=False
# - APP_ENV=production
#
